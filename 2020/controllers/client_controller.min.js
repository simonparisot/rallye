function expand(e){$(e).hasClass("fixed")?$(".curtain").removeClass("reduced").removeClass("expanded"):($(".curtain").removeClass("expanded").addClass("reduced"),$(e).removeClass("reduced").addClass("expanded"))}function getstate(){$.getJSON("controllers/state.php",function(e){state=e}),$.getJSON("controllers/clue.php",function(e){clue=e})}function loadcontent(e){expand($(e).parents(".curtain")),$(e).siblings(".selected").not(e).removeClass("selected"),$(e).addClass("selected");var t=$(e).attr("code");if(state[t]){var n="Déjà résolu ! Le "+new Date(1e3*state[t]).toLocaleDateString("fr-fr",{dateStyle:"long"})+".";clue[t]&&(n+="Vous aviez d'ailleurs obtenu l'indice suivant : "+clue[t]),$(".content-solved",".expanded").html(n).css("background-color","LightGreen").show()}else $(".content-solved",".expanded").hide();var o=activeCode();if("E16"==(o=o.substring(0,3)))$(e).parents(".curtain").find(".content-src").html('<iframe frameborder="0" width="480" height="270" src="https://www.dailymotion.com/embed/video/x7pdva2" allowfullscreen allow="autoplay"></iframe>');else if("E18"==o)$(e).parents(".curtain").find(".content-src").html('<iframe frameborder="0" width="480" height="270" src="https://www.dailymotion.com/embed/video/x7poce4" allowfullscreen allow="autoplay"></iframe>');else if("E20"==o){var s="content/"+t+".pdf?t="+Date.now();$(e).parents(".curtain").find(".content-src").html('<embed src="'+s+'#view=FitH&toolbar=0&statusbar=0&navpanes=0" alt="pdf" type="application/pdf" pluginspage="http://www.adobe.com/products/acrobat/readstep2.html">')}else{s="content/"+t+".pdf";$(e).parents(".curtain").find(".content-src").html('<embed src="'+s+'#view=FitH&toolbar=0&statusbar=0&navpanes=0" alt="pdf" type="application/pdf" pluginspage="http://www.adobe.com/products/acrobat/readstep2.html">')}"PBO"==o?$(".content-header form").hide():$(".content-header form").show(),$(".reponse").val("").blur(),updateDiscussion()}function tester(t){var e=t.reponse.value;if(""===e)$(t).children(".reponse").fadeOut(80).fadeIn(80).fadeOut(80).fadeIn(80);else $.get("controllers/verify.php",{code:activeCode(),pwd:e},function(e){e.ok?color="LightGreen":color="Red",$(t).parents(".curtain").find(".content-solved").html(e.texte).css("background-color",color).slideDown(),e.ok&&($(".col-gauche",".white").load("views/enigmes-list.php"),$(".col-gauche",".grey").load("views/quest-list.php"),$(".main-content",".purple").load("views/team-content.php"),getstate())},"json")}function donnerAvis(){var e=$("textarea",".commentaires").val();""===e?$("textarea",".commentaires").fadeOut(80).fadeIn(80).fadeOut(80).fadeIn(80):$.post("controllers/donnerAvis.php",{msg:e},function(){$(".commentaires").html("C'est envoyé, merci !"),$("textarea",".commentaires").val("")})}function majStats(){$(".stats-img").html("");var t=$("span",".statEni").text(),n=$("span",".statQuest").text();if(0!=t||0!=n){for(e in $(".bienvenue").hide(),$(".stats").show(),moustache='<span class="tooltip"><img src="ressources/img/moustache.png"><span><img class="callout" src="ressources/img/callout.gif"><b>Enigme #1 - #2</b><br>débloquée le #3</span></span>',solved)$(".stats-img",".statEni").append(moustache.replace("#1",e).replace("#2",$("li","#enigmes-list").eq(e-1).text()).replace("#3",solved[e]));for(var o=0;o<n;o++)$(".stats-img",".statQuest").append('<img src="ressources/img/shoe.png">')}}function poster(){var e=$(".enigme-discussion input[type='text']").val(),t=$(".enigme-discussion textarea").val();""==e?$(".enigme-discussion input[type='text']").fadeOut(80).fadeIn(80).fadeOut(80).fadeIn(80):""==t?$(".enigme-discussion textarea").fadeOut(80).fadeIn(80).fadeOut(80).fadeIn(80):($.post("controllers/discussion.php",{nom:e,newpost:t,enigme:activeCode()},function(){updateDiscussion()}),$(".enigme-discussion form")[0].reset(),$(".allposts",".expanded").prepend('<div class="loading"><img src="ressources/img/loading.gif"></div>'))}function discussion(){$(".enigme-discussion",".expanded").hasClass("slided")?$(".enigme-discussion",".expanded").removeClass("slided"):(updateDiscussion(),$(".enigme-discussion",".expanded").addClass("slided"))}function updateDiscussion(){$.getJSON("controllers/discussion.php",{enigme:activeCode()},function(e){$(".allposts").html(""),"nothing"==e[0]?($(".allposts",".expanded").append('<div class="post examplepost">Aucune discussion n\'a été entamée pour cette énigme, à vous de jouer ;)</div>'),$("#comCount").hide()):"error"==e[0]?$(".allposts",".expanded").append('<div class="post examplepost">Désolé, impossible d\'effectuer cette opération :(</div>'):"loginerror"==e[0]?window.location="?":($.each(e,function(e,t){$(".allposts",".expanded").append('<div class="post">'+t.texte+"</div>").children().last().prepend('<div class="postdelete" date="'+t.date+'" nom="'+t.nom+'"></div>').prepend('<span class="postdate">'+t.nicedate+"</span><br/>").prepend('<span class="posttitle">'+t.nom+"</span>")}),$("#comCount").html(e.length).show())})}function activeNb(){return $(".expanded").find(".selected").index()+1}function activeCode(){return $(".expanded").find(".selected").attr("code")}$(document).ready(function(){$("body").on("click touchend",".reduced",function(e){expand(this)}),$(".col-gauche",".white").on("click","li:not(.deactivated)",function(e){loadcontent(this)}),$(".col-gauche",".grey").on("click","li:not(.deactivated)",function(e){loadcontent(this)}),$("textarea").autogrow(),$(".mail-orga").on("click",function(){$(this).html("rallye.hiver.2020@gmail.com").addClass("revealed")}),$("#popin").on("click",function(){$("#popin").toggle()}),$(".downloadButton").on("click",function(){window.location="controllers/download.php?code="+activeCode()}),$(".clueButton").on("click",function(){$("#popin section").load("views/indice.php",function(){$("#popin").toggle()})}),$(".content-header form").on("submit",function(e){e.preventDefault(),tester(this)}),$(".commentaires form").on("submit",function(e){e.preventDefault(),donnerAvis()}),$(".enigme-discussion form").on("submit",function(e){e.preventDefault(),poster()}),$(".discussButton").on("click",function(){discussion()}),$(".enigme-discussion").on("click",".postdelete",function(){$(this).attr("nom");$.post("controllers/discussion.php?delete",{nom:$(this).attr("nom"),date:$(this).attr("date"),enigme:activeCode()},function(){updateDiscussion()})}),getstate(),$(".folded").removeClass("folded")}),function(n){n.fn.autogrow=function(t){return this.filter("textarea").each(function(){function e(e){var t=""==o.value?s.attr("placeholder"):o.value;t=t.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/\n$/,"<br/>&nbsp;").replace(/\n/g,"<br/>").replace(/ {2,}/g,function(e){return function(e,t){for(var n=0,o="";n<t;n++)o+=e;return o}("&nbsp;",e.length-1)+" "}),e&&e.data&&"keydown"===e.data.event&&13===e.keyCode&&(t+="<br />"),d.css("width",s.width()),d.html(t+(0===i?"...":""));var n=Math.max(d.height()+i,a);null!=c.preGrowCallback&&(n=c.preGrowCallback(s,d,n,a)),s.height(n),null!=c.postGrowCallback&&c.postGrowCallback(s)}var o=this,s=n(o),a=s.height(),i=s.hasClass("autogrow-short")?0:parseInt(s.css("lineHeight"))||0,c=n.extend({preGrowCallback:null,postGrowCallback:null},t),d=n("<div></div>").css({position:"absolute",top:-1e4,left:-1e4,width:s.width(),fontSize:s.css("fontSize"),fontFamily:s.css("fontFamily"),fontWeight:s.css("fontWeight"),lineHeight:s.css("lineHeight"),resize:"none","word-wrap":"break-word"}).appendTo(document.body);s.change(e).keyup(e).keydown({event:"keydown"},e),n(window).resize(e),e()})}}(jQuery);