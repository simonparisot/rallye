function expand(e){$(e).hasClass("fixed")?$(".curtain").removeClass("reduced").removeClass("expanded"):($(".curtain").not(e).removeClass("expanded").addClass("reduced"),$(e).removeClass("reduced").addClass("expanded"))}function chargerEnigme(e){if(expand(".white"),$(e).siblings(".selected").not(e).removeClass("selected"),$(e).addClass("selected"),19!=active()&&20!=active()||!$(e).attr("rel")){t="enigmes/img/Enigme "+active()+" - "+$(e).text()+".jpg";$(".downloadButton").show()}else{var t="enigmes/img/Enigme "+active()+" - "+$(e).text()+$(e).attr("rel")+".jpg";$(".downloadButton").hide()}switch($(".panel-enigme").html('<img src="'+t+'">'),active()){case 2:$(".panel-enigme").append('<audio controls><source src="enigmes/Enigme 2 - Les 7 familles en or.mp3" type="audio/mpeg">Impossible d\'afficher cette énigme. Contactez-nous svp.</audio>');break;case 20:$(".panel-enigme").html('<p style="text-align:center;">Cette énigme de rapidité était accessible et résoluble uniquement le 22 février lors de son lancement.<br>Merci de vous être connectés si nombreux ce soir là :)</p>'),$(".discussButton").hide(),$(".downloadButton").hide();break;case 21:$(".panel-enigme").html("<p style=\"text-align:center;\">Cette énigme n'a pas d'énoncé.</p>"),$(".downloadButton").hide()}0!=$(".solved[rel="+active()+"]").length?(solvedText="Vous avez déjà résolu cette énigme (la première fois le "+$(".solved[rel="+active()+"]").attr("date")+").",$(".enigme-response",".expanded").html(solvedText).css("background-color","#bbffc2").show()):$(".enigme-response",".expanded").hide(),$("#e_password",".expanded").val("").blur(),updateDiscussion()}function chargerQuest(e){expand(".grey"),$(e).siblings(".selected").not(e).removeClass("selected"),$(e).addClass("selected");var t="quest/"+$(e).attr("code")+" - "+$(e).text()+".pdf";$(".panel-quest").html('<embed src="'+t+'" alt="pdf" pluginspage="http://www.adobe.com/products/acrobat/readstep2.html">'),$(".quest-header").show()}function tester(){var e=$("#e_password").val();if(""===e)$("#e_password").fadeOut(80).fadeIn(80).fadeOut(80).fadeIn(80);else $.get("controllers/verify.php",{enigme:active(),mdp:e},function(e){e.ok?color="#bbffc2":color="#e85938",$(".enigme-response").html(e.texte).css("background-color",color).slideDown(),e.ok&&($(".grey").removeClass("fixed").find(".col-gauche").load("views/quest-list.php"),$(".main-content",".purple").load("views/team-content.php"))},"json")}function donnerAvis(){var e=$("textarea",".commentaires").val();""===e?$("textarea",".commentaires").fadeOut(80).fadeIn(80).fadeOut(80).fadeIn(80):$.post("controllers/donnerAvis.php",{msg:e},function(){$(".commentaires").html("C'est envoyé, merci !"),$("textarea",".commentaires").val("")})}function majStats(){$(".stats-img").html("");var t=$("span",".statEni").text(),n=$("span",".statQuest").text();if(0!=t||0!=n){for(e in $(".bienvenue").hide(),$(".stats").show(),moustache='<span class="tooltip"><img src="ressources/img/moustache.png"><span><img class="callout" src="ressources/img/callout.gif"><b>Enigme #1 - #2</b><br>débloquée le #3</span></span>',solved)$(".stats-img",".statEni").append(moustache.replace("#1",e).replace("#2",$("li","#enigmes-list").eq(e-1).text()).replace("#3",solved[e]));for(var s=0;s<n;s++)$(".stats-img",".statQuest").append('<img src="ressources/img/shoe.png">')}}function poster(){var e=$(".enigme-discussion input[type='text']").val(),t=$(".enigme-discussion textarea").val();""==e?$(".enigme-discussion input[type='text']").fadeOut(80).fadeIn(80).fadeOut(80).fadeIn(80):""==t?$(".enigme-discussion textarea").fadeOut(80).fadeIn(80).fadeOut(80).fadeIn(80):($.post("controllers/discussion.php",{nom:e,newpost:t,enigme:active()},function(){updateDiscussion()}),$(".enigme-discussion form")[0].reset(),$(".allposts",".expanded").prepend('<div class="loading"><img src="ressources/img/loading.gif"></div>'))}function discussion(){$(".enigme-discussion",".expanded").hasClass("slided")?$(".enigme-discussion",".expanded").removeClass("slided"):(updateDiscussion(),$(".enigme-discussion",".expanded").addClass("slided"))}function updateDiscussion(){$.getJSON("controllers/discussion.php",{enigme:active()},function(e){$(".allposts").html(""),"nothing"==e[0]?($(".allposts",".expanded").append('<div class="post font2 examplepost">Aucune discussion n\'a été entamée pour cette énigme, à vous de jouer ;)</div>'),$("#comCount").hide()):"error"==e[0]?$(".allposts",".expanded").append('<div class="post font2 examplepost">Désolé, impossible d\'effectuer cette opération :(</div>'):"loginerror"==e[0]?window.location="?":($.each(e,function(e,t){$(".allposts",".expanded").append('<div class="post font2">'+t.texte+"</div>").children().last().prepend('<div class="postdelete" date="'+t.date+'" nom="'+t.nom+'"></div>').prepend('<span class="font2 postdate">'+t.nicedate+"</span><br/>").prepend('<span class="font2 posttitle">'+t.nom+"</span>")}),$("#comCount").html(e.length).show())})}function active(){return $(".expanded").find(".selected").index()+1}function questcode(){return $("li:nth-child("+active()+")","#quest-list").attr("code")}$(document).ready(function(){$("body").on("click touchend",".reduced",function(e){expand(this)}),$(".col-gauche",".white").on("click","li:not(.deactivated)",function(e){chargerEnigme(this)}),$(".col-gauche",".grey").on("click","li:not(.deactivated)",function(e){chargerQuest(this)}),$("textarea").autogrow(),$(".mail-orga").on("click",function(){$(this).html('<i class="fas fa-envelope"></i> theb2.rallye@gmail.com').css("background-color","#eee").css("font-weight","bold")}),$("#popin").on("click",function(){$("#popin").toggle()}),$(".downloadButton").on("click",function(){window.location="controllers/download.php?enigme="+active()}),$(".downloadParcours").on("click",function(){window.location="controllers/download.php?code="+questcode()}),$(".clueButton").on("click",function(){$("#popin section").load("views/indice.php",function(){$("#popin").toggle()})}),$(".content-header form").on("submit",function(e){e.preventDefault(),tester()}),$(".commentaires form").on("submit",function(e){e.preventDefault(),donnerAvis()}),$(".enigme-discussion form").on("submit",function(e){e.preventDefault(),poster()}),$(".discussButton").on("click",function(){discussion()}),$(".enigme-discussion").on("click",".postdelete",function(){$(this).attr("nom");$.post("controllers/discussion.php?delete",{nom:$(this).attr("nom"),date:$(this).attr("date"),enigme:active()},function(){updateDiscussion()})}),null==document.createElement("input").placeholder&&$("[placeholder]").on("focus",function(){$(this).val()==$(this).attr("placeholder")&&$(this).val("")}).on("blur",function(){""==$(this).val()&&$(this).val($(this).attr("placeholder"))}).blur().parents("form").on("submit",function(){$(this).find("[placeholder]").each(function(){$(this).val()==$(this).attr("placeholder")&&$(this).val("")})})}),function(n){n.fn.autogrow=function(t){return this.filter("textarea").each(function(){function e(e){var t=s.value.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/\n$/,"<br/>&nbsp;").replace(/\n/g,"<br/>").replace(/ {2,}/g,function(e){return function(e,t){for(var n=0,s="";n<t;n++)s+=e;return s}("&nbsp;",e.length-1)+" "});e&&e.data&&"keydown"===e.data.event&&13===e.keyCode&&(t+="<br />"),l.css("width",o.width()),l.html(t+(0===a?"...":""));var n=Math.max(l.height()+a,i);null!=c.preGrowCallback&&(n=c.preGrowCallback(o,l,n,i)),o.height(n),null!=c.postGrowCallback&&c.postGrowCallback(o)}var s=this,o=n(s),i=o.height(),a=o.hasClass("autogrow-short")?0:parseInt(o.css("lineHeight"))||0,c=n.extend({preGrowCallback:null,postGrowCallback:null},t),l=n("<div></div>").css({position:"absolute",top:-1e4,left:-1e4,width:o.width(),fontSize:o.css("fontSize"),fontFamily:o.css("fontFamily"),fontWeight:o.css("fontWeight"),lineHeight:o.css("lineHeight"),resize:"none","word-wrap":"break-word"}).appendTo(document.body);o.change(e).keyup(e).keydown({event:"keydown"},e),n(window).resize(e),e()})}}(jQuery);