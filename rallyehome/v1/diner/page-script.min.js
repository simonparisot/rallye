function signup(){var e="";guests=new Array,id="",teamname=document.getElementById("team-name").value,""==teamname&&(e="Vous avez oublié le nom de l'équipe");for(var t=document.getElementsByClassName("guys"),n=0;n<t.length;n++){var a=t[n].querySelector('input[name="name"]').value,s=t[n].querySelector('input[name="email"]').value;""==a&&""==s||(""==a?e="Merci de renseigner le nom de tous les participants, pour les reconnaitre sur place !":""==s?e="Merci de renseigner l'adresse e-mail de tous les participants, pour pouvoir les contacter !":validateEmail(s)?guests.push([a,s]):e="Attention ce n'est pas une adresse e-mail valide")}if(0==guests.length&&(e="Vous devez renseigner au moins un participant"),""==e){changecontent("processing");var o=new XMLHttpRequest,r={team:teamname,guests:guests};console.log(JSON.stringify(r)),o.onreadystatechange=function(){if(4===o.readyState)if(201===o.status){var e=JSON.parse(o.response);id=e.id;var t=document.getElementsByClassName("t-name");Array.prototype.forEach.call(t,function(e){e.innerHTML=teamname});t=document.getElementsByClassName("t-count");Array.prototype.forEach.call(t,function(e){e.innerHTML=guests.length});t=document.getElementsByClassName("t-price");Array.prototype.forEach.call(t,function(e){e.innerHTML=25*guests.length}),changecontent("payment")}else document.getElementById("form-error").innerHTML="Désolé, il y a eu un problème :("},o.open("POST","https://g1t0ssi5cb.execute-api.eu-west-3.amazonaws.com/prod/diner-signup",!0),o.setRequestHeader("Content-Type","application/json"),o.send(JSON.stringify(r))}else document.getElementById("form-error").innerHTML=e}function validateEmail(e){return/^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/.test(String(e).toLowerCase())}function ajouterCo(){var e=document.createElement("div");e.className="guys",e.innerHTML='<input type="text" name="name" placeholder="Prénom et nom"><input type="mail" name="email" class="coeq-mail mailinput" placeholder="Adresse e-mail"><div id="addCo" onclick="ajouterCo();">Ajouter un participant</div>';var t=document.querySelectorAll(".guys"),n=t[t.length-1],a=document.getElementById("addCo");n.removeChild(a),n.parentNode.insertBefore(e,n.nextSibling)}function changecontent(e){document.getElementsByClassName("active")[0].classList.remove("active"),document.getElementById(e).classList.add("active")}function processPayment(t){changecontent("processing");var n=new XMLHttpRequest,e={token:t.id,email:t.email,team:teamname,id:id,amount:2500*guests.length};n.onreadystatechange=function(){if(4===n.readyState)if(200===n.status){var e=document.getElementsByClassName("a-mail");Array.prototype.forEach.call(e,function(e){e.innerHTML=t.email}),changecontent("allgood")}else alert("Désolé, il y a eu un problème dans le traitement de votre paiement par CB. Aucune somme n'a été débitée. Je vous redirige vers le paiment par chèque comme plan B. Toutes les excuses de l'organisation."),changecontent("cheque")},n.open("POST","https://g1t0ssi5cb.execute-api.eu-west-3.amazonaws.com/prod/diner-payment",!0),n.setRequestHeader("Content-Type","application/json"),n.send(JSON.stringify(e))}var handler=StripeCheckout.configure({key:"pk_live_cCDQlUF3TzwDqP15EBt3JHcP",image:"res/logo-small.jpg",locale:"fr",token:function(e){processPayment(e)}}),els=document.getElementsByClassName("paybutton");Array.prototype.forEach.call(els,function(e){e.addEventListener("click",function(e){handler.open({name:"Rallye d'Hiver 2019",description:"Inscription au diner",currency:"eur",amount:2500*guests.length,allowRememberMe:!1}),e.preventDefault()})}),window.addEventListener("popstate",function(){handler.close()});